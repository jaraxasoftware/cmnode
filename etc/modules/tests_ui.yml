version: 1.0
type: module
category: ui
name: tests_ui
spec:
  init:
    model:
      tests: []
      test: {}
      selected_test: ""
      test_activity:
        object:
          max: 0
          active: 0
          pending: 0
          state:
            text:
              literal: "green"
          items:
            object:
              pending: []
              active: []
  decoders:
    show_tests:
      object:
        effect:
          keyword: ui
        event:
          one_of:
            - text: 
                literal: "tests"
            - keyword: tests
    show_test:
      object:
        effect:
          keyword: ui
        event:
          object:
            name: 
              keyword: "show_test"
            test:
              any: text
    pre_schedule_test:
      object:
        effect:
          keyword: ui
        event:
          object:
            name:
              keyword: pre_schedule
            test:
              any: text
    schedule_test:
      object:
        effect:
          keyword: ui
        event:
          object:
            name:
              keyword: schedule
            test:
              any: text
            settings:
              any: text
    show_scenario:
      object:
        effect:
          keyword: ui
        event:
          object:
            name: 
              keyword: "show_scenario"
            test:
              any: text
            scenario:
              any: text
    show_background:
      object:
        effect:
          keyword: ui
        event:
          object:
            name: 
              keyword: "show_background"
            test:
              any: text
            background:
              any: text
    toggle_activity:
      object:
        effect:
          keyword: ui
        event:
          keyword: toggle_activity
    show_test_reports:
      object:
        effect:
          keyword: ui
        event:
          one_of:
            - keyword: show_test_reports
            - text: 
                literal: "show_test_reports"
    show_test_report:
      object:
        effect:
          keyword: ui
        event:
          object:
            name:
              keyword: show_test_report
            report:
              any: text
    tests_activity:
      object:
        effect:
          keyword: ws
        data:
          object:
            tests:
              object:
                active:
                  any: number
                pending:
                  any: number
                state:
                  any: text
                max:
                  any: number
                items:
                  object:
                    active: 
                      any: list
                    pending:
                      any: list
    tests:
      object:
        effect:
          keyword: ws
        data:
          object:
            tests:
              list:
                object:
                  name: 
                    any: text
                  backgrounds:
                    any: number
                  scenarios:
                    any: number
    test:
      object:
        effect:
          keyword: ws
        data:
          object:
            test:
              object:
                name:
                  any: text
                scenarios:
                  list:
                    object:
                      title:
                        any: text
                backgrounds:
                  one_of:
                    - list:
                        object:
                          title:
                            any: text
                    - list: empty
    scenario:
      object:
        effect:
          keyword: ws
        data:
          object:
            scenario:
              object:
                test:
                  any: text
                title:
                  any: text
                tags:
                  any: list
                steps:
                  any: list
                backgrounds:
                  any: list
    background:
      object:
        effect:
          keyword: ws
        data:
          object:
            background:
              object:
                test:
                  any: text
                title:
                  any: text
                tags:
                  any: list
                steps:
                  any: list
                scenarios:
                  any: list
    test_reports:
      object:
        effect:
          keyword: ws
        data:
          object:
            test_reports:
              list: any
    test_report:
      object:
        effect:
          keyword: ws
        data:
          object:
            test_report:
              object:
                id:
                  any: text
                timestamp:
                  any: number
                query:
                  any: text
                settings:
                  any: text
                millis:
                  any: number
                status:
                  any: text
                scenarios:
                  object:
                    fail: 
                      any: number
                    success:
                      any: number
                    total:
                      any: number
                failures:
                  one_of:
                    - list:
                        size: 0
                    - list:
                        object: any
    test_settings:
      object:
        effect:
          keyword: ws
        data:
          object:
            settings:
              list: any
  update:
    show_tests:
      cmds:
        - effect: ws
          encoder: subscribe_to_tests
        - effect: ws
          encoder: tests
        - effect: ws
          encoder: test_activity_query
        - effect: ws
          encoder: settings_query
        - effect: ui
          encoder: tests_view
    test_settings:
      model:
        settings:
          key: settings
          in: data
      cmds:
        - effect: ui
    tests:
      model:
        tests:
          key: tests
          in: 
            key: data
      cmds:
        - effect: ui
    test_reports:
      model:
        test_reports:
          key: test_reports
          in: data
      cmds:
        - effect: ui
    test_report:
      model:
        test_report:
          key: test_report
          in: data
      cmds:
        - effect: ui
          encoder: test_report_view
    tests_activity:
      model:
        test_activity:
          key: tests
          in: data
      cmds:
        - effect: ws
          encoder: test_reports
        - effect: ui
    show_test:
      model:
        test: 
          key: test
          in: event
      cmds:
        - effect: ws
          encoder: test_info
    show_scenario:
      model:
        scenario: 
          key: scenario
          in: event
      cmds:
        - effect: ws
          encoder: scenario_info
    show_background:
      model:
        background: 
          key: background
          in: event
      cmds:
        - effect: ws
          encoder: background_info
    show_test_reports:
      model:
        activity_panel:
          keyword: visible
        test_reports: []
      cmds:
        - effect: ui
          encoder: test_reports_view
        - effect: ws
          encoder: subscribe_to_tests
        - effect: ws
          encoder: test_reports
        - effect: ws
          encoder: test_activity_query
        - effect: ws
          encoder: settings_query
    show_test_report:
      model:
        report: 
          key: report
          in: event
      cmds:
        - effect: ws
          encoder: test_report
    test:
      model:
        test:
          key: test
          in: data
      cmds:
        - effect: ui
          encoder: test_view
    scenario:
      model:
        scenario:
          key: scenario
          in: data
      cmds:
        - effect: ui
          encoder: scenario_view
    background:
      model:
        background:
          key: background
          in: data
      cmds:
        - effect: ui
          encoder: background_view
    toggle_activity:
      - when:
          eq:
            - key: activity_panel
            - keyword: visible
        model:
          activity_panel:
            keyword: hidden
        cmds:
          - effect: ui
      - when:
          eq:
            - key: activity_panel
            - keyword: hidden 
        model:
          activity_panel:
            keyword: visible
        cmds:
          - effect: ui
    schedule_test:
      model:
        selected_settings:
          key: settings
          in: event
      cmds:
        - effect: ws
          encoder: schedule_test
    pre_schedule_test:
      model:
        selected_test: 
          key: test
          in: event
      cmds:
        - effect: ui
          encoder: schedule_test_view
  encoders:
    tests:
      object:
        action: tests
    subscribe_to_tests:
      object:
        action: subscribe
        topic: tests
    test_reports:
      object:
        action: test_reports
        days: 7 
    schedule_test:
      object:
        action: 
          text:
            literal: "schedule"
        test:
          key: selected_test
        settings:
          key: selected_settings
    test_activity_query:
      object:
        action: 
          text:
            literal: "test_activity"
        test:
          key: test
    settings_query:
      object:
        action: 
          text:
            literal: "settings"
    test_selection:
      object:
        name:
          keyword: show_test
        test:
          key: name
          in: item
    scenario_selection:
      object:
        name:
          keyword: show_scenario
        scenario:
          key: title
          in: item
        test:
          key: test
          in: context
    background_selection:
      object:
        name:
          keyword: show_background
        background:
          key: title
          in: item
        test:
          key: test
          in: context
    test_info:
      object:
        action: 
          keyword: test
        test:
          key: test
    scenario_info:
      object:
        action:
          keyword: scenario
        test:
          key: name
          in: test
        scenario:
          key: scenario
    background_info:
      object:
        action:
          keyword: background
        test:
          key: name
          in: test
        background:
          key: background
    test_report:
      object:
        action:
          keyword: test_report
        report:
          key: report
    test_table_item_view:
      view:
        tag: "tr"
        attrs:
          key:
            key: name
            in: item
        children:
          - tag: td
            attrs:
              key: "name"
            children:
              - tag: span
                attrs:
                  class: "d-block"
                children:
                  - text:
                      key: name
                      in: item
              - tag: span
                attrs:
                  style: "margin-left: 0 !important"
                  class: "table-item-info"
                children:
                  - text:
                      format: 
                        pattern: "~a background(s), ~a scenario(s)"
                        params:
                          - key: backgrounds 
                            in: item
                          - key: scenarios 
                            in: item

          - tag: td
            attrs:
              class: "text-right"
            children:
              - tag: button
                attrs:
                  class: "btn btn-sm btn-primary c-hand mx-2"
                  onclick:
                    object:
                      name:
                        keyword: show_test
                      test:
                        key: name
                        in: item
                children:
                  - text:
                      literal: "View definition"
              
              - tag: button
                attrs:
                  class: "btn btn-sm btn-primary c-hand mx-2"
                  onclick:
                    object:
                      name:
                        keyword: pre_schedule
                      test:
                        key: name
                        in: item
                children:
                  - text:
                      literal: "Run this test"
    tests_table_view:
      view:
        view: table
        params:
          object:
            headers:
              list:
                - object:
                    title: 
                      text:
                        literal: " "
                - object:
                    title:
                      text: 
                        literal: " "
            items:
              key: tests
            item_view:
              keyword: test_table_item_view
    tests_header_button_view:
      view:
        tag: a
        attrs:
          class: "c-hand d-inline-block"
          onclick:
            key: target
            in: item
        children:
          - text:
              key: title
              in: item
    test_in_progress_item_view:
      view:
        tag: div
        attrs:
          class: "item columns"
          style: "padding-top: 10px; padding-bottom: 10px;"
          key: 
            key: id
            in: item
        children:
          - tag: div
            attrs:
              class: "column col-6"
            children:
              - tag: div
                children:
                  - tag: strong
                    children:
                      - text: 
                          key: name
                          in: item
                  - tag: span
                    attrs:
                      class: "table-item-info"
                    children:
                      - timestamp:
                          format: human
                          value:
                            key: timestamp
                            in: item
          - tag: div
            attrs:
              class: "column col-6 text-right"
            children:
              - view: test_report_settings_label
                params:
                  object:
                    data:
                      key: info
                      in: item

    tests_in_progress_view:
      view:
        tag: div
        attrs:
          key:
            key: title
          class: "tests-in-progress"
        children:
          - tag: div
            children:
              loop: 
                key: items
              with: test_in_progress_item_view
    test_schedule_with_settings_button:
      view:
        tag: button
        attrs:
          class: "btn btn-primary d-block form-input mb-2"
          onclick:
            object:
              name:
                keyword: schedule
              test:
                key: test
                in: context
              settings:
                key: name
                in: item
        children:
          - text:
              key: name
              in: item 
    tests_main_view:
      view:
        tag: div
        attrs:
          key: "tests-main-view"
          class: "card"
        children:
          - tag: div
            attrs:
              key: "tests-view-links"
              class: "text-right"
            children:
              - tag: a
                attrs:
                  class: "link c-hand mx-2"
                  onclick:
                    keyword: show_test_reports
                children:
                  - text:
                      literal: "Test reports"

          - tag: h1
            attrs:
              class: "content-view"
            children:
              - text:
                  literal: "Test definitions"
          - view: tests_table_view
            params:
              object:
                tests:
                  key: tests
                  in: data
    tests_view:
      view:
        view: layout
        params:
          object:
            theme:
              key: theme
            message:
              key: message
            content_view:
              keyword: tests_main_view
            contents:
              object:
                tests: 
                  key: tests
                test:
                  key: test
                selected_test:
                  key: selected_test
                test_activity:
                  key: test_activity
                settings:
                  key: settings
            sidebar:
              keyword: admin_sidebar
    test_report_badge_view:
      view:
        tag: span
        attrs:
          class:
            either:
              - when:
                  eq:
                    - key: fail
                      in: scenarios
                    - number: 0
                text:
                  format:
                    pattern: "~a circle bg-success d-inline-block"
                    params:
                      - key: size
              - when:
                  eq:
                    - key: success
                      in: scenarios
                    - number: 0
                text:
                  format:
                    pattern: "~a circle bg-error d-inline-block"
                    params:
                      - key: size
              - text:
                  format:
                    pattern: "~a circle bg-warning d-inline-block"
                    params:
                      - key: size
    test_report_status_view:
      view:
        tag: span
        attrs:
          class: "ml-2"
        children:
          - text:
              either:
                - when:
                    eq:
                      - key: fail
                      - number: 0
                  literal: "Pass"
                - literal: "Fail"
    test_reports_table_item_view:
      view:
        tag: "tr"
        attrs:
          key:
            key: query
            in: item
        children:
          - tag: td
            attrs:
              key: "test"
            children:
              - tag: span
                attrs:
                  class: "d-block"
                children:
                  - text:
                      key: query
                      in: item
              
              - view: test_report_badge_view
                params:
                  object:
                    scenarios:
                      key: scenarios
                      in: item
                    size: 
                      text:
                        literal: "size-12-12"
              
              - tag: span
                attrs:
                  class: "table-item-info"
                children:
                  - timestamp:
                      format: human
                      value:
                        key: timestamp
                        in: item
              - tag: span
                attrs:
                  class: "table-item-info"
                children:
                  - text:
                      format:
                        pattern: "~a scenario(s), ~a passed, ~a failed"
                        params:
                          - key: total
                            in:
                              key: scenarios
                              in: item
                          - key: success 
                            in:
                              key: scenarios
                              in: item
                          - key: fail 
                            in:
                              key: scenarios
                              in: item

          - tag: td
            attrs:
              key: "settings"
            children:
              - tag: span
                attrs:
                  class: "label label-rounded"
                children:
                  - text:
                      key: settings
                      in: item
          - tag: td
            attrs:
              class: "text-right"
            children:
              - tag: button
                attrs:
                  class: "btn btn-primary btn-sm c-hand mx-2"
                  onclick:
                    object:
                      name: 
                        keyword: show_test_report
                      report:
                        key: id
                        in: item
                children:
                  - text:
                      literal: "View report"
              - tag: button
                attrs:
                  class: "btn btn-primary btn-sm c-hand mx-2"
                  onclick:
                    object:
                      name:
                        keyword: pre_schedule
                      test:
                        key: query
                        in: item
                children:
                  - text:
                      literal: "Run again"
          
    test_reports_table_view:
      view:
        view: table
        params:
          object:
            headers:
              list:
                - object:
                    title: 
                      text:
                        literal: " "  
                - object:
                    title: 
                      text:
                        literal: " "
                - object:
                    title: 
                      text:
                        literal: " "
            items:
              key: test_reports
            item_view:
              keyword: test_reports_table_item_view
    test_reports_sections_view:
      view:
        tag: div
        children:
          - view: test_reports_table_view
            params:
              object:
                test_reports:
                  key: test_reports
                  in: data
    test_reports_main_view:
      view:
        tag: div
        attrs:
          key: "test-reports-main-view"
          class: "card"
        children:
          - tag: div
            attrs:
              key: "test-reports-view-links"
              class: "text-right"
            children:
              - tag: a
                attrs:
                  class: "link c-hand mx-2"
                  onclick:
                    keyword: tests
                children:
                  - text:
                      literal: "Test definitions"

          - tag: h1
            attrs:
              class: "content-view"
            children:
              - text:
                  literal: "Test reports"
          - view: test_reports_table_view
            params:
              test_reports:
                key: test_reports
                in: data
    test_reports_view:
      view:
        view: layout
        params:
          object:
            theme:
              key: theme
            message:
              key: message
            content_view:
              keyword: test_reports_main_view
            contents:
              object:
                test_reports: 
                  key: test_reports
                test_activity:
                  key: test_activity
                test:
                  key: test
                selected_test:
                  key: selected_test
                settings:
                  key: settings
            sidebar:
              keyword: admin_sidebar
    test_scenario_tag_view:
      view:
        tag: span
        attrs:
          class: "mr-2 label label-rounded tag"
        children:
          - text:
              key: item
    test_scenario_tags_view:
      view:
        tag: div
        children:
          loop:
            key: data 
          with: test_scenario_tag_view
    test_scenario_table_item_view:
      view:
        tag: "tr"
        attrs:
          key:
            key: title
            in: item
        children:
          - tag: td
            children:
              - view: scenario_link_view
                params:
                  object:
                    item: 
                      key: item
                    context:
                      key: context
    test_scenarios_table_view:
      view:
        view: table
        params:
          object:
            headers:
              list:
                - object:
                    title: 
                      text:
                        literal: " "
            items:
              key: scenarios
            context:
              object:
                test:
                  key: test
            item_view:
              keyword: test_scenario_table_item_view
    test_scenarios_view:
      view: 
        tag: div
        children:
          - tag: h5
            children:
              - text:
                  literal: "Scenarios"
          - view: test_scenarios_table_view
            params:
              object:
                test:
                  key: test
                scenarios:
                  key: scenarios
    background_link_view:
      view:
        tag: a
        attrs:
          class: "c-hand"
          onclick:
            encoder: background_selection
        children:
          - text:
              key: title
              in: item
    background_links_view:
      view:
        tag: div
        attrs:
          class: "links"
        children:
          loop:
            key: backgrounds
            in: data
          context:
            object:
              test:
                key: test
                in: data
          with: background_link_view
    scenario_link_view:
      view:
        tag: a
        attrs:
          class: "c-hand"
          onclick:
            encoder: scenario_selection
        children:
          - text:
              key: title
              in: item
    scenario_links_view:
      view:
        tag: div
        attrs:
          class: "links"
        children:
          loop:
            key: scenarios
            in: data
          context:
            object:
              test:
                key: test
                in: data
          with: scenario_link_view
    test_background_table_item_view:
      view:
        tag: "tr"
        attrs:
          key:
            key: title
            in: item
        children:
          - tag: td
            children:
              - view: background_link_view
                params:
                  object:
                    item: 
                      key: item
                    context:
                      key: context
    test_backgrounds_table_view:
      view:
        view: table
        params:
          object:
            headers:
              list:
                - object:
                    title: 
                      text:
                        literal: " "
            items:
              key: backgrounds
            context:
              object:
                test:
                  key: test
            item_view:
              keyword: test_background_table_item_view
    test_backgrounds_view:
      view: 
        tag: div
        attrs:
          class: "mt-4"
        children:
          - tag: h5
            attrs:
              class: "mt-2"
            children:
              - text:
                  literal: "Backgrounds"
          - view: test_backgrounds_table_view
            params:
              object:
                test:
                  key: test
                backgrounds:
                  key: backgrounds
    test_sections_view:
      view:
        tag: div
        attrs:
          key: "test-sections"
          class: "card"
        children:
          - tag: div
            attrs:
              class: "text-right"
            children:
              - tag: a
                attrs:
                  class: "link c-hand"
                  onclick:
                    keyword: tests
                children:
                  - text:
                      literal: "Back to tests"
          
          - tag: h1
            attrs:
              class: "content-view"
            children:
              - text:
                  key: name 
                  in:
                    key: test
                    in: data
                  
          - view: test_scenarios_view
            params:
              object:
                test:
                  key: name 
                  in:
                    key: test
                    in: data
                scenarios:
                  key: scenarios
                  in:
                    key: test
                    in: data
          - view: test_backgrounds_view
            params:
              object:
                test:
                  key: name 
                  in: 
                    key: test
                    in: data
                backgrounds:
                  key: backgrounds
                  in:
                    key: test
                    in: data
    test_view:
      view:
        view: layout
        params:
          object:
            theme:
              key: theme
            message:
              key: message
            content_view:
              keyword: test_sections_view
            contents:
              object:
                test: 
                  key: test
                test_activity:
                  key: test_activity
            sidebar:
              keyword: admin_sidebar
    test_status_view:
      view:
        tag: div
        children:
          - view: test_report_badge_view
            params:
              object:
                size: 
                  text:
                    literal: "size-16-16"
                scenarios:
                  key: data
          - view: test_report_status_view
            params:
              key: data
          - tag: div
            attrs:
              class: "text-secondary"
            children:
              - text:
                  format:
                    pattern: "~a scenario(s), ~a passed, ~a failed"
                    params:
                      - key: total
                        in: data 
                      - key: success
                        in: data 
                      - key: fail
                        in: data 

    test_report_settings_label:
      view:
        tag: span
        attrs:
          class: "label label-rounded settings"
        children:
          - text:
              key: data
    test_report_stats_view:
      view:
        tag: div
        attrs:
          class: "card"
        children:
          - tag: div
            attrs:
              class: "text-right"
            children:
              - tag: a
                attrs:
                  class: "link c-hand"
                  onclick:
                    keyword: show_test_reports
                children:
                  - text:
                      literal: "Back to reports"
          - tag: h1
            attrs:
              class: "content-view"
            children:
              - text:
                  literal: "Report summary"

          - view: info_view
            params:
              object:
                title: 
                  text:
                    literal: " "
                items:
                  list:
                    - object:
                        title:
                          text:
                            literal: "Test"
                        view:
                          keyword: text_view
                        value:
                          key: query
                          in: report
                    - object:
                        title:
                          text:
                            literal: "Settings"
                        view:
                          keyword: test_report_settings_label
                        value:
                          key: settings
                          in: report

                    - object:
                        title:
                          text:
                            literal: "Ran"
                        view:
                          keyword: date_view
                        value:
                          object:
                            format: 
                              text:
                                literal: "~a ~b ~e"
                            value:
                              key: timestamp
                              in: report
                    - object:
                        title:
                          text:
                            literal: "Status"
                        view:
                          keyword: test_status_view
                        value:
                          key: scenarios
                          in: report

    test_report_failure_step_view:
      view:
        tag: div
        children:
          - text:
              key: title
              in: data
          - view: json_view
            params:
              object:
                source:
                  object:
                    type:
                      key: type
                      in: data
                    spec:
                      key: spec
                      in: data
    test_report_failure_connections_view:
      view:
        tag: div
        children:
          - view: json_view
            params:
              object:
                source:
                  object:
                    spec:
                      key: conns
                      in: data
    test_report_failure_data_view:
      view:
        tag: div
        children:
          - view: json_view
            params:
              object:
                source:
                  object:
                    spec:
                      key: data
                      in: data
    accordion_view:
      view:
        tag: div
        attrs:
          key: 
            key: id
          class: "accordion"
        children:
          - tag: input
            attrs:
              class: "d-hide"
              type: "checkbox"
              id:
                key: id
          - tag: label
            attrs:
              class: "c-hand accordion-header"
              for:
                key: id
            children:
              - view:
                  key: view
                  in: header
                params:
                  key: data
                  in: header
          - tag: div
            attrs:
              class: "accordion-body"
            children:
              - view:
                  key: view
                  in: body
                params:
                  key: data
                  in: body
   
    test_report_failure_header_view:
      view: 
        tag: div
        children:
          - view: info_item_view
            params:
              object:
                item:
                  object:
                    title:
                      text:
                        literal: "Scenario"
                    view:
                      keyword: text_view
                    value:
                      key: scenario
          - view: info_item_view
            params:
              object:
                item:
                  object:
                    title:
                      text:
                        literal: "Step"
                    view:
                      keyword: text_view
                    value:
                      key: step
          - view: info_item_view
            params:
              object:
                item:
                  object:
                    title:
                      text:
                        literal: "Reason"
                    view:
                      keyword: text_view
                    value:
                      key: reason
                      
    test_report_failure_body_item_view:
      view:
        tag: "tr"
        children:
          - tag: td
            attrs:
              class: "v-top"
            children:
              - view: json_view
                params:
                  object:
                    source:
                      key: step
                      in: item
          - tag: td
            attrs:
              class: "v-top"
            children:
              - view: json_view
                params:
                  object:
                    source:
                      key: world 
                      in: item

    test_report_failure_body_view:
      view: 
        tag: div
        attrs:
          style: "margin-top: 15px"
        children:
          - view: table
            params:
              object:
                headers:
                  list:
                    - object:
                        title:
                          text:
                            literal: "Step"
                    - object:
                        title:
                          text:
                            literal: "World"
                items:
                  list:
                    - object:
                        step:
                          key: step
                        world:
                          key: world
                item_view:
                  keyword: test_report_failure_body_item_view
    test_report_failure_view:
      view:
        tag: div
        attrs:
          class: "container"
        children:
          - view: accordion_view
            params:
              object:
                id: 
                  text:
                    literal: "failure-1"
                header:
                  object:
                    view:
                      keyword: test_report_failure_header_view
                    data:
                      object:
                        scenario:
                          key: scenario
                          in:
                            key: failure
                            in: item
                        step:
                          key: title
                          in:
                            key: step
                            in:
                              key: failure
                              in: item
                        reason:
                          key: error
                          in: 
                            key: reason
                            in:
                              key: failure
                              in: item
                body:
                  object:
                    view:
                      keyword: test_report_failure_body_view
                    data:
                      object:
                        step:
                          key: step
                          in:
                            key: failure
                            in: item
                        world:
                          key: world
                          in:
                            key: failure
                            in: item
    test_report_failures_view:
      view:
        tag: div
        attrs:
          class: "card mt-4"
          key: "report-failures"
        children:
          - tag: div
            children:
              - tag: h1
                attrs:
                  class: "content-view"
                children:
                  - text:
                      literal: "Failures"
          - tag: div
            children:
              loop:
                key: failures
              with: test_report_failure_view
    test_report_sections_view:
      view:
        tag: div
        attrs:
          key: "report-sections"
        children:
          - view: test_report_stats_view
            params:
              object:
                report: 
                  key: test_report
                  in: data
          - view: test_report_failures_view
            when:
              not:
                eq:
                  - number: 0
                  - key: fail
            params:
              object:
                fail:
                  key: fail
                  in:
                    key: scenarios
                    in: 
                      key: test_report
                      in: data
                failures:
                  key: failures
                  in: 
                    key: test_report
                    in: data
    test_report_view:
      view:
        view: layout
        params:
          object:
            theme:
              key: theme
            message:
              key: message
            content_view:
              keyword: test_report_sections_view
            contents:
              object:
                test_report: 
                  key: test_report
                test_activity:
                  key: test_activity
                settings:
                  key: settings
                selected_test:
                  key: selected_test
            sidebar:
              keyword: admin_sidebar
    scenario_step_table_item_view:
      view:
        tag: "tr"
        attrs:
          key:
            key: title
            in: item
        children:
          - tag: td
            attrs:
              class: "v-top"
            children:
              - text:
                  key: title
                  in: item
          - tag: td
            attrs:
              class: "v-top"
            children:
              - view: json_view
                params:
                  object:
                    source:
                      object:
                        type:
                          key: type
                          in: item
                        spec:
                          key: spec
                          in: item
    scenario_steps_table_view:
      view:
        tag: div
        children:
          - view: table
            params:
              object:
                items:
                  key: steps
                item_view:
                  keyword: scenario_step_table_item_view
    scenario_info_view:
      view:
        tag: div
        attrs:
          class: "card"
        children:
          - tag: div
            attrs:
              class: "text-right"
            children:
              - tag: a 
                attrs:
                  class: "link c-hand"
                  onclick:
                    keyword: tests
                children:
                  - text:
                      literal: "Back to tests"
          
          - tag: h1
            attrs:
              class: "content-view"
            children:
              - text:
                  key: title

          - view: info_view
            params:
              object:
                title: 
                  text:
                    literal: " "
                items:
                  list:
                    - object:
                        title:
                          text:
                            literal: "Test"
                        value:
                          key: test
                        view:
                          keyword: text_view
                    - object:
                        title:
                          text: 
                            literal: "Tags"
                        value:
                          key: tags
                        view:
                          keyword: test_scenario_tags_view
                    - object:
                        title:
                          text: 
                            literal: "Backgrounds"
                        value:
                          object:
                            test:
                              key: test
                            backgrounds:
                              key: backgrounds
                        view:
                          keyword: background_links_view
    scenario_steps_view:
      view:
        tag: div
        attrs:
          class: "card mt-4"
        children:
          - tag: h1
            children:
              - text:
                  literal: "Steps"
          - view: scenario_steps_table_view
            params:
              object:
                steps:
                  key: steps
    
    scenario_sections_view:
      view:
        tag: div
        attrs:
          key: "scenario-sections"
        children:
          - view: scenario_info_view
            params:
              key: scenario
              in: data
          - view: scenario_steps_view
            params:
              key: scenario
              in: data
    scenario_view:
      view:
        view: layout
        params:
          object:
            theme:
              key: theme
            message:
              key: message
            content_view:
              keyword: scenario_sections_view
            contents:
              object:
                scenario: 
                  key: scenario
            sidebar:
              keyword: admin_sidebar
    background_info_view:
      view:
        tag: div
        attrs:
          class: "card"
        children:
          - tag: div
            attrs:
              class: "text-right"
            children:
              - tag: a
                attrs:
                  class: "link c-hand"
                  onclick:
                    keyword: tests
                children:
                  - text:
                      literal: "Back to tests"
          - tag: h1
            attrs:
              class: "content-view"
            children:
              - text:
                  key: title

          - view: info_view
            params:
              object:
                title: 
                  text:
                    literal: " "
                items:
                  list:
                    - object:
                        title:
                          text:
                            literal: "Test"
                        value:
                          key: test
                        view:
                          keyword: text_view
                    - object:
                        title:
                          text: 
                            literal: "Tags"
                        value:
                          key: tags
                        view:
                          keyword: test_scenario_tags_view
                    - object:
                        title:
                          text: 
                            literal: "Scenarios"
                        value:
                          object:
                            test:
                              key: test
                            scenarios:
                              key: scenarios
                        view:
                          keyword: scenario_links_view
    background_step_table_item_view:
      view:
        tag: "tr"
        attrs:
          key:
            key: title
            in: item
        children:
          - tag: td
            attrs:
              class: "v-top"
            children:
              - text:
                  key: title
                  in: item
          - tag: td
            attrs:
              class: "v-top"
            children:
              - view: json_view
                params:
                  object:
                    source:
                      object:
                        type:
                          key: type
                          in: item
                        spec:
                          key: spec
                          in: item
    background_steps_table_view:
      view:
        view: table
        params:
          object:
            items:
              key: steps
            item_view:
              keyword: background_step_table_item_view
    background_steps_view:
      view:
        tag: div
        attrs:
          class: "card mt-4"
        children:
          - tag: h1
            attrs:
              class: "content-view"
            children:
              - text:
                  literal: "Steps"
          - view: background_steps_table_view
            params:
              object:
                steps:
                  key: steps
    background_sections_view:
      view:
        tag: div
        attrs:
          key: "background-sections"
        children:
          - view: background_info_view
            params:
              key: background
              in: data
          - view: background_steps_view
            params:
              key: background
              in: data
    background_main_view:
      view: 
        view: tests_layout_view_without_inspector
        params:
          object:
            title:
              key: title
              in:
                key: background 
                in: data
            actions:
              list:
                - object:
                    title:
                      text: 
                        literal: "Back to tests"
                    target: 
                      keyword: tests
            content_view:
              keyword: background_sections_view
            data:
              key: background
              in: data
    background_view:
      view:
        view: layout
        params:
          object:
            theme: 
              key: theme
            message:
              key: message
            content_view:
              keyword: background_sections_view
            contents:
              object:
                background: 
                  key: background
            sidebar:
              keyword: admin_sidebar
    schedule_test_selection_view:
      view:
        tag: div
        children:
          - tag: div
            attrs:
              class: "text-secondary"
            children:
              - text:
                  literal: "Choose the environment to run this test against"
          - tag: div
            attrs:
              class: "mt-4"
            children:
              loop: 
                key: settings
              with: test_schedule_with_settings_button
              context:
                object:
                  test:
                    key: test

    schedule_test_activity_view:
      view:
        tag: div
        children:
          - tag: div
            attrs:
              class: "text-secondary"
            children:
              - text:
                  format:
                    pattern: "~a test(s) running, ~a waiting, ~a max"
                    params:
                      - key: active
                        in: test_activity
                      - key: pending
                        in: test_activity
                      - key: max
                        in: test_activity
                      
          - tag: div
            attrs:
              style: "margin-top: 10px; margin-bottom: 10px;"
            children:
              - view: progress
                params:
                  object:
                    value:
                      sum:
                        - key: active
                          in: test_activity
                        - key: pending
                          in: test_activity
                    max:
                      key: max
                      in: test_activity
          - view: tests_in_progress_view
            when:
              not:
                eq:
                  - number: 0
                  - key: pending
            params:
              object:
                pending:
                  key: pending
                  in: test_activity
                title:
                  text:
                    literal: " "
                items:
                  key: pending
                  in: 
                    key: items
                    in: test_activity
    schedule_test_main_view:
      view:
        tag: div
        attrs:
          key: "schedule-test-view"
          class: "card"
        children:
          - tag: div
            attrs:
              class: "text-right"
            children:
              - tag: a
                attrs:
                  class: "link c-hand"
                  onclick:
                    keyword: show_test_reports
                children:
                  - text:
                      literal: "Test reports"
              - tag: a
                attrs:
                  class: "link c-hand"
                  onclick:
                    keyword: tests
                children:
                  - text:
                      literal: "Test definitions"
          - tag: h1
            attrs:
              class: "content-view"
            children:
              - text:
                  key: test
                  in: data

          - tag: div
            attrs:
              class: "columns"
            children:
              - tag: div
                attrs:
                  class: "column col-6"
                children:
                  - view: schedule_test_selection_view
                    params:
                      object:
                        test:
                          key: test
                          in: data
                        settings:
                          key: settings
                          in: data

              - tag: div
                attrs:
                  class: "column col-6"
                children:
                  - view: schedule_test_activity_view
                    params:
                      object:
                        test_activity:
                          key: test_activity
                          in: data
    schedule_test_view:
      view:
        view: layout
        params:
          object:
            theme:
              key: theme
            message:
              key: message
            content_view:
              keyword: schedule_test_main_view
            contents:
              object:
                settings:
                  key: settings
                test: 
                  key: selected_test
                test_activity:
                  key: test_activity
            sidebar:
              keyword: admin_sidebar
