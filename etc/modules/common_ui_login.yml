version: 1.0
type: module
category: client
name: common_ui_login
spec:
  init:
    model:
      object:
        message: ""
        email: 
          text:
            literal: ""
        password:
          text:
            literal: ""
        state: ""
    cmds:
      - effect: ui 
        encoder: login_view
  update:
    email_changed:
      model:
        object:
          email:
            key: value
      cmds:
        - effect: ui
    password_changed:
      model:
        object:
          password:
            key: value
      cmds:
        - effect: ui
    send_login:
      model:
        object:
          state: 
            keyword: logging_in
      cmds:
        - effect: ws
          encoder: login
        - effect: ui
    show_login:
      cmds:
        - effect: ui
          encoder: login_view
    user:
      - when:
          eq:
            - key: state
            - keyword: registering
        model:
          object:
            password:
              text: 
                literal: ""
            password_confirm:
              text: 
                literal: ""
            message:
              text:
                literal: "Now please login with your new account"
        cmds:
          - effect: ui
            encoder: login_view
      - when:
          eq:
            - key: state
            - keyword: logging_in 
        model:
          object:
            message:
              text:
                literal: ""
        cmds:
          - effect: events
            encoder: user_logged_in
    invalid:
      - when:
          eq:
            - key: state
            - keyword: logging_in
        model:
          object:
            state: 
              keyword: login
            message:
              text:
                literal: "Please check your data and try again"
        cmds:
          - effect: ui
    not_found:
      - when:
          eq:
            - key: state
              keyword: logging_in
        model:
          object:
            state: 
              keyword: login
            message:
              text:
                literal: "Invalid credentials"
        cmds:
          - effect: ui
            encoder: login_view
    forbidden:
      - when:
          eq:
            - key: state
            - keyword: logging_in
        model: 
          object:
            state:
              keyword: login
            message:
              text:
                literal: "Invalid credentials"
        cmds:
          - effect: ui
  encoders:
    login:
      object:
        action:
          text:
            literal: "login"
        username: 
          key: email 
        password:
          key: password
    login_view:
      view:
        view: simple
        params:
          content_view:
            keyword: panel
          content:
            object:
              style: "login filled"
              header:
                icon: "fas fa-lock"
                title: "Login"
                subtitle: "Please enter your credentials to login."
              message:
                key: message
              view: form
              content: 
                object:
                  fields:
                    - content_view: input
                      content:
                        id: "email"
                        title: "Email"
                        placeholder: "example@gmail.com"
                        help: "Your email address"
                        value:
                          key: email
                    - content_view: password
                      content:
                        id: "password"
                        title: "Password"
                        placeholder: "******"
                        help: "Your strong password"
                        value:
                          key: password
                  actions:
                    - content_view: primary_button
                      content:
                        onclick: "send_login"
                        title: "Login"
    user_logged_in:
      object:
        event: 
          keyword: user_logged_in
  decoders:
    show_login:
      object:
        effect:
          keyword: ui
        event:
          keyword: show_login
    email_changed:
      object:
        effect:
          keyword: ui
        event:
          text:
            literal: email
        value:
          text: any
    password_changed:
      object:
        effect:
          keyword: ui
        event:
          text:
            literal: password
        value:
          text: any
    send_login:
      object:     
        effect:
          keyword: ui
        event:
          keyword: send_login
    user:
      object:
        effect:
          keyword: ws
        data:
          object:
            id:
              text: any
            email:
              text: any
            first: 
              text: any
            last:
              text: any
