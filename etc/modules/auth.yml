type: module 
name: auth
spec:
  decoders:
    token:
      object:
        headers:
          authorization:
            non_empty: text
    anonymous:
      one_of:
        - object:
            headers:
              authorization:
                empty: text
        - object:
            headers:
              without_keys:
                - authorization
  update:
    token:
      model:
        token:
          key: headers.authorization
      cmds:
        - effect: service
          encoder: verify
    anonymous:
      cmds:
        - effect: terminate
          encoder: forbidden
  encoders:
    verify:
      object:
        service: token_verify
        params:
          token:
            key: token
