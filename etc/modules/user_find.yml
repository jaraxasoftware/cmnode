type: module
name: user_find 
spec:
  decoders:
    lookup:
      object:
        bucket:
          any: keyword
        uid:
          any: number
    found:
      object: 
        status: 
          keyword: ok
        data:
          object:
            value:
              any: object
    not_found:
      object:
        status: 
          keyword: ok
        data:
          empty: list
    error:
      object:
        status:
          keyword: error
  update:
    lookup:
      model:
        object:
          uid:
            key: uid
          bucket:
            key: bucket
      cmds:
        - effect: db
          encoder: lookup
    found:
      model:
        user:
          key: data.value
      cmds:
        - effect: terminate
          encoder: user
    error:
      cmds:
        - effect: terminate
          encoder: error
    not_found:
      cmds:
        - effect: terminate
          encoder: error
  encoders:
    user:
      object:
        status:
          keyword: ok
        user:
          key: user
    lookup:
      object:
        context: lookup
        bucket:
          key: bucket
        get:
          object:
            subject: user 
            predicate: is 
            object:
              key: uid
