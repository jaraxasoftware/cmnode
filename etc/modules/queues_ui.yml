version: 1.0
type: module
category: ui
name: queues_ui
spec:
  init:
    model:
      object:
        queues:
          list: []
  decoders:
    show_queues:
      object:
        effect:
          keyword: ui
        event:
          text:
            literal: "queues"
    queues:
      object:
        effect:
          keyword: ws
        data:
          object:
            queues:
              any: list
  update:
    queues:
      model:
        object:
          queues:
            key: queues
            in: 
              key: data
      cmds:
        - effect: ui
          encoder: queues_view
    show_queues:
      cmds:
        - effect: ui
          encoder: queues_view
        - effect: ws
          encoder: queues
  encoders:
    queues:
      object: 
        action:
          keyword: queues 
    queue_table_item_view:
      view:
        tag: "tr"
        attrs:
          key:
            key: name
            in: item
        children:
          - tag: td
            children:
              - text:
                  key: name
                  in: item
          - tag: td
            children:
              - tag: div
                children:
                  - tag: div
                    children:
                      - text:
                          key: active
                          in:
                            key: status
                            in: item
                      - text:
                          literal: " active out of " 
                      - text:
                          key: concurrency
                          in:
                            key: capacity
                            in: item
                  - view: progress
                    params:
                      object:
                        value:
                          key: active
                          in:
                            key: status
                            in: item
                        max:
                          key: concurrency
                          in:
                            key: capacity
                            in: item
              - tag: div
                children:
                  - tag: div
                    children:
                      - text:
                          key: pending 
                          in:
                            key: status
                            in: item
                      - text:
                          literal: " pending out of "
                      - text:
                          key: max
                          in:
                            key: capacity
                            in: item
                  - view: progress
                    params:
                      object:
                        value:
                          key: pending
                          in:
                            key: status
                            in: item
                        max:
                          key: max
                          in:
                            key: capacity
                            in: item
    queues_table_view:
      view:
        view: table
        params:
          object:
            headers:
              list:
                - object:
                    title: 
                      text:
                        literal: "Name"
                - object:
                    title: 
                      text:
                        literal: "Status"
            items:
              key: data
            item_view:
              keyword: queue_table_item_view
    queues_section_view:
      view:
        view: section
        params:
          object:
            view:
              keyword: queues_table_view
            data:
              key: data
    queues_main_view:
      view:
        view: main
        params:
          object:
            title:
              text:
                literal: "Queues"
            view:
              keyword: queues_table_view
            data:
              key: data
    queues_view: 
      view:
        view: layout
        params:
          object:
            message:
              key: message
            content_view:
              keyword: queues_main_view
            contents:
              key: queues
            sidebar:
              keyword: admin_sidebar
