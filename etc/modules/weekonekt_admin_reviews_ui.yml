version: 1.0
type: module
category: ui
name: weekonekt_admin_reviews_ui
spec:
  init:
    model:
      reviews: []
      theme: "dark"
      selected: "reviews"
  decoders:
    ready:
      object:
        effect:
          keyword: events
        event:
          keyword: user_logged_in
    show_reviews:
      object:
        effect:
          keyword: ui
        event:
          one_of:
            - keyword: reviews
            - text: reviews
    reviews:
      object:
        effect:
          keyword: ws
        data:
          object:
            reviews:
              list:
                object:
                  date: 
                    any: number
                  id:
                    any: text
                  lat:
                    any: number
                  lon:
                    any: number
                  title:
                    any: text
                  cover:
                    any: text
                  author:
                    any: text
  update:
    ready:
      model:
        reviews: []
      cmds:
        - effect: ws
          encoder: reviews_query
        - effect: ui
          encoder: reviews_view
    show_reviews:
      model:
        reviews: []
      cmds:
        - effect: ws
          encoder: reviews_query
        - effect: ui
          encoder: reviews_view
    reviews:
      model:
        reviews:
          key: reviews
          in: data
      cmds:
        - effect: ui
          encoder: reviews_view
  encoders:
    reviews_query:
      object:
        app:
          text: "weekonekt"
        action:
          text: "reviews"
    review_location_map_view:
      view:
        map:
          id:
            key: id
          style: dark
          center:
            lat:
              key: lat
            lon:
              key: lon
          zoom: 9
          markers:
            - lat:
                key: lat
              lon:
                key: lon
    review_cover_view:
      view:
        tag: img
        attrs:
          style: "width: 100%; height: 100%;"
          src:
            text:
              format:
                pattern: "~a/?id=~a"
                params:
                  - key: assets
                  - key: id
    review_item_view:
      view:
        tag: div
        attrs:
          class: "column col-4 p-2 review-item-view"
          key:
            key: id
            in: item
          onclick:
            object:
              name:
                keyword: show_review
              id:
                key: id
                in: item
        children:
          - tag: div
            attrs:
              class: "cover-image"
              style:
                text:
                  format: 
                    pattern: "background-image: url('~a/?id=~a')"
                    params:
                      - key: assets
                      - key: cover
                        in: item
          - tag: div
            attrs:
              class: "columns mt-4"
            children:
              - tag: div
                attrs:
                  class: "column col-2 text-center"
                children:
                  - view: avatar_view
                    params:
                      object:
                        initials: "MM"
                        size: "lg"
                        photo:
                          format:
                            pattern: "~a/?id=~a"
                            params:
                              - key: assets
                              - key: author 
                                in: item

              - tag: div
                attrs:
                  class: "column col-10"
                children:
                  - tag: div 
                    children:
                      - text:
                          key: title
                          in: item
                  - tag: div
                    attrs:
                      class: "text-secondary"
                      style: "font-weight: 300;"
                    children:
                      - tag: small
                        children:
                          - text: "Posted on June 12th 2018, at 5:29pm"
                  - tag: span 
                    attrs:
                      class: "label label-rounded"
                    children:
                      - text: "Accomodation"
    reviews_collection_view:
      view:
        tag: div
        attrs:
          class: "columns"
        children:
          loop:
            key: reviews
          with: review_item_view
    reviews_main_view:
      view:
        tag: div
        children:
          - view: reviews_collection_view
            params:
              object:
                reviews:
                  key: reviews
    reviews_actions_view:
      view:
        tag: div
        attrs:
          class: "text-right"
        children:
          - tag: a
            attrs:
              class: "link c-hand"
            children:
              - text: 
                  literal: "Create new"
    reviews_layout_view:
      view:
        tag: div
        attrs:
          key: "reviews"
        children:
          - view: reviews_actions_view
          - view: reviews_main_view
            params:
              object:
                reviews:
                  key: data
    reviews_view: 
      view:
        view: weekonekt_admin_layout
        params:
          object:
            theme:
              key: theme
            selected:
              key: selected
            message:
              key: message
            content_view:
              keyword: reviews_layout_view
            contents:
              key: reviews



                
