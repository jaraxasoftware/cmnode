version: 1.0
type: module
category: server
name: mock_oauth_api 
spec:
  decoders:
    valid_authorization:
      object:
        headers:
          object:
            authorization:
              text:
                regexp: "Bearer user"
            client_id: "3434323666396432626437353336363735616464386335343930636332313237"
    invalid_authorization:
      object:
        headers:
          object:
            authorization:
              text:
                other_than:
                  text:
                    regexp: "Bearer user"
            client_id: "3434323666396432626437353336363735616464386335343930636332313237"
    missing_authorization:
      object:
        headers:
          without_keys:
            - authorization
    invalid_client_id:
      object:
        headers:
          one_of:
            - without_keys:
                - client_id
            - object:
                client_id: 
                  text:  
                    other_than: "3434323666396432626437353336363735616464386335343930636332313237"
  update:
    valid_authorization:
      model:
        object:
          user_id:
            hash:
              key: authorization
              in: headers
          msad_id:
            hash:
              format:
                pattern: "~s ~s"
                params:
                  - key: authorization
                    in: headers
                  - key: client_id
                    in: headers
      cmds:
        - effect: notify
          encoder: authorized
        - effect: terminate
    invalid_authorization:
      cmds:
        - effect: notify
          encoder: invalid_access_token 
        - effect: terminate
    missing_authorization:
      cmds:
        - effect: notify
          encoder: missing_access_token 
        - effect: terminate
    invalid_client_id:
      cmds:
        - effect: notify
          encoder: invalid_access_token 
        - effect: terminate
  encoders:
    authorized:
      object:
        status: 200
        headers:
          content-type: "application/json; charset=utf-8"
          expires: "-1"
          cache-control: "no-cache"
          pragma: "no-cache"
        body:
          object:
            result: "OK"
            returnValue:
              object:
                message: "success"
                data:
                  object:
                    msad_id:
                      key: msad_id
                    bdu_id:
                      key: user_id
                    name:
                      format: 
                        pattern: "name ~w"
                        params:
                          - key: user_id
                    surname:
                      format: 
                        pattern: "surname ~w"
                        params:
                          - key: user_id
                    email: 
                      format: 
                        pattern: "~w@mail.com"
                        params:
                          - key: user_id
                    birth_date: "1991-02-16 00:00:00Z"
    authorized_deprecated:
      object:
        status: 200
        headers:
          content-type: "application/json; charset=utf-8"
          expires: "-1"
          cache-control: "no-cache"
          pragma: "no-cache"
        body:
          object:
            Resultado:
              object:
                VALUE: "OK"
                RES:
                  object:
                    CODE: "0"
                    DATA:
                      MSAD_ID:
                        key: msad_id
                      BDU_ID:
                        key: user_id
                      name:
                        format: 
                          pattern: "name ~w"
                          params:
                            - key: user_id
                      surname:
                        format: 
                          pattern: "surname ~w"
                          params:
                            - key: user_id
                      email: 
                        format: 
                          pattern: "~w@mail.com"
                          params:
                            - key: user_id
                      birth_date: "16/02/1991 0:00:00"
    invalid_access_token:
      object:
        status: 401
        headers:
          content-type: "text/plain; charset=utf-8"
          expires: "-1"
          cache-control: "no-cache"
          pragma: "no-cache"
        body:
          text: "User Unauthorized. Procotol Fault exception. Invalid access token."
    missing_access_token:
      object:
        status: 401
        headers:
          content-type: "text/plain; charset=utf-8"
          expires: "-1"
          cache-control: "no-cache"
          pragma: "no-cache"
        body:
          text: "User not authorized: Authorization Bearer Header missing."
