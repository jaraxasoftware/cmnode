version: 1.0
category: api
type: module
name: wkreview_api
spec:
  decoders:
    query_review:
      object:
        app: "weekonekt"
        action: "review"
        id: 
          any: text
    review:
      object:
        context:
          keyword: review
        bucket: 
          keyword: weekonekt
        value:
          object:
            title:
              any: text
            lat:
              any: number
            lon:
              any: number
            id:
              any: text
            images:
              list:
                object:
                  id:
                    any: text
                  title:
                    any: text
            cover:
              any: text
            author:
              object:
                id:
                  any: text
                first:
                  any: text
                last:
                  any: text
            options:
              list:
                object:
                  name:
                    any: text
                  contents:
                    any: text
  update:
    query_review:
      model:
        id:
          key: id
      cmds:
        - effect: db_get
          encoder: review_query
    review:
      model:
        review:
          key: value
      cmds:
        - effect: notify 
          encoder: review
  encoders:
    review_query:
      object:
        query:
          object:
            context:
              keyword: review
            bucket:
              keyword: weekonekt
            type:
              keyword: review
            id: 
              key: id
        join:
          object:
            images:
              object:
                bucket:
                  keyword: weekonekt
                type:
                  keyword: image
            author:
              object:
                bucket: 
                  keyword: users
                type:
                  keyword: user
    review:
      object:
        review:
          key: review
