version: 1.0
type: task
name: netcomp_release_build
spec:
  - task: netcomp_assembly
  - git:
      credentials:
        key: github
        in: settings
      tag: 
        repo: "github.com/kalta/netcomp.git"
        branch: v09
        clone: false
        dir: 
          format: 
            pattern: "/tmp/~s"
            params:
              - key: name
                in: params
        prefix: 
          format:
            pattern: "~s-v"
            params:
              - key: name
                in: params
        increment:
          key: increment
          in: params
      as: tag
  - docker:
      credentials:
        key: docker
        in: settings
      build:
        dir:
          format:
            pattern: "/tmp/~s"
            params:
              - key: name
                in: params
        repo: "netcomposer/netcomp"
        tag:
          key: tag
          in: context
