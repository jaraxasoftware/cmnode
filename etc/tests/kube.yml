version: 1.0
type: test
name: kube
spec:
  config:
    retries: 100
    wait: 5
  backgrounds:
    - title: "Ensure Kubernetes API server is online"
      steps:
        - title: "Connect to the Api server"
          connect:
            kubernetes:
              host:
                key: api
                in: 
                  key: kubernetes
                  in: settings
              token:
                key: token
                in:
                  key: kubernetes
                  in: settings
          as: kubernetes
        - title: "Check it is online"
          probe:
            connection: kubernetes
            status: up
  scenarios:
    - title: "Check namespace NC exists"
      tags:
        - kube
      backgrounds:
        - "Ensure Kubernetes API server is online"
      steps:
        - title: "Get all namespaces"
          send:
            to: kubernetes
            spec:
              object:
                list:
                  keyword: namespaces
        - title: "Verify NC is present"
          receive:
            from: kubernetes
            spec:
              object:
                items:
                  first:
                    object:
                      metadata:
                        object:
                          name:
                            text:
                              literal: "nc"
