version: 1.0
type: module
category: client
name: admin_scm 
spec:
  init:
    model:
      scheme:
        text: 
          literal: "Hello" 
    cmds:
      - effect: scheme
        encoder: app
  update:
    scheme:
      model:
        scheme: 
          from: source 
      cmds:
        - effect: notify
          encoder: scheme
  encoders:
    app:
      object:
        app:
          spec: 
            init:
              model:
                state: 
                  keyword: init
              cmds:
                - effect: ui 
                  encoder: login_view
            update:
              ws_connected:
                model:
                  message:
                    text:
                      literal: "Server reachable"
                cmds:
                  - effect: ui
                    encoder: login_view
              ws_disconnected:
                model:
                  message:
                    text:
                      literal: "Disconnected from server" 
                cmds:
                  - effect: ui
                    encoder: login_view
              ws_error:
                model:
                  message:
                    text:
                      literal: "Server connection error"
                cmds:
                  - effect: ui
                    encoder: login_view
              email_changed:
                model:
                  email:
                    from: value
              password_changed:
                model:
                  password:
                    from: value
              send_login:
                cmds:
                  - effect: ws
                    encoder: login
            encoders:
              login:
                object:
                  username: 
                    from: email 
                  password:
                    from: password
              user_message:
                view:
                  tag: div
                  attrs: 
                    key: user-message
                    class: warning
                  children:
                    - text: 
                        from: message 
              input:
                view:
                  tag: div
                  attrs:
                    key: 
                      from: id
                    class: "form-group col-3 col-md-4 col-sm-12 col-xs-12"
                  children:
                    - tag: label
                      attrs:
                        class: "form-label"
                        for: 
                          from: id
                      children:
                        - text: 
                            from: title
                    - tag: input
                      attrs:
                        class: "form-input"
                        type: "text"
                        id: 
                          from: id
                        placeholder: 
                          from: title
                        onchange:
                          from: id
              password:
                view:
                  tag: div
                  attrs:
                    key: 
                      from: id
                    class: "form-group col-3 col-md-4 col-sm-12 col-xs-12"
                  children:
                    - tag: label
                      attrs:
                        class: "form-label"
                        for: 
                          from: id
                      children:
                        - text: 
                            from: title
                    - tag: input
                      attrs:
                        class: "form-input"
                        type: "password"
                        id: 
                          from: id
                        placeholder: 
                          from: title
                        onchange:
                          from: id
              button:
                view:
                  tag: div
                  children:
                    - tag: button
                      attrs:
                        class: "btn btn-primary"
                        onclick:
                          from: click
                      children:
                        - text:
                            from: title
              link:
                view:
                  tag: div
                  attrs:
                    onclick:
                      from: click
                    key: 
                      from: id
                  children:
                    - tag: a
                      attrs:
                        href: "#"
                      children:
                        - text: 
                            from: title
              login_view:
                view:
                  tag: div 
                  attrs:
                    class: container
                  children:
                    - tag: h1
                      attrs:
                        key: title
                      children:
                        - text: "Welcome"
                    - view: user_message
                      when: message
                    - view: input
                      params:
                        object:
                          id: 
                            literal: "email"
                          title:
                            literal: "Email"
                    - view: password 
                      params:
                        object:
                          id: 
                            literal: "password"
                          title:
                            literal: "Password"
                    - view: button
                      params:
                        object:
                          click:
                            keyword: send_login
                          title:
                            literal: "Login"
                    - view: link
                      params:
                        object:
                          id: 
                            literal: recover_password 
                          click:
                            keyword: show_recover_password
                          title:
                            literal: "Recover password"
                    - view: link
                      params:
                        object:
                          id: 
                            literal: signup
                          click:
                            keyword: show_signup
                          title:
                            literal: "Create an account"
                      

            
            decoders:
              ws_connected:
                object:
                  effect:
                    keyword: ws
                  event:
                    keyword: connected
              ws_disconnected:
                object:
                  effect:
                    keyword: ws
                  event:
                    keyword: disconnected
              ws_error:
                object:
                  effect:
                    keyword: ws
                  event:
                    keyword: error
              show_signup:
                object:
                  effect:
                    keyword: ui
                  event:
                    keyword: show_signup
              show_recover_password:
                object:
                  effect:
                    keyword: ui
                  event:
                    keyword: show_recover_password
              email_changed:
                object:
                  effect:
                    keyword: ui
                  event:
                    text:
                      literal: email
                  value:
                    text: any
              password_changed:
                object:
                  effect:
                    keyword: ui
                  event:
                    text:
                      literal: password
                  value:
                    text: any
              send_login:
                object:     
                  effect:
                    keyword: ui
                  event:
                    keyword: send_login

            effects:
              ui:
                type: elementary-ui
              ws:
                type: elementary-ws
                settings:
                  url: ws://localhost:8080/ws 
          
    scheme:
      data: 
        from: scheme
  decoders:
    scheme:
      object:
        language:
          keyword: scheme
        status:
          keyword: ok
        source:
          text: any
