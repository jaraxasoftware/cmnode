version: 1.0
type: module
category: ui
name: app_ui
spec:
  init:
    model:
      category: 
        keyword: none
      debug:
        keyword: none
      config:
        list: []
  update:
    app_info:
      model:
        category:
          from: category
          at: 
            from: info
            at: data
        debug:
          from: debug
          at:
            from: info
            at: data
      cmds:
        - effect: ui
          encoder: app_view
    app_config:
      model:
        config:
          from: config
          at: data
      cmds:
        - effect: ui
          encoder: app_view
    no_modules:
      cmds:
        - effect: ui
          encoder: app_view
    modules:
      model:
        modules:
          from: modules
          at: data
        modules_view:
          keyword: app_modules_table_view
      cmds:
        - effect: ui
          encoder: app_view
    show_app:
      model:
        modules:
          list: []
        app:
          key: name
          in:
            key: app
            in: event
        modules_view: 
          keyword: app_modules_empty_view
      cmds:
        - effect: ui
          encoder: app_view
        - effect: ws
          encoder: app_modules
        - effect: ws
          encoder: app_info
        - effect: ws
          encoder: app_config
  encoders:
    app_modules:
      object: 
        action:
          keyword: modules
        app:
          from: app
    app_info:
      object: 
        action:
          keyword: info
        app:
          from: app
    app_config:
      object: 
        action:
          keyword: config
        app:
          from: app
    module_selection:
      object:
        name:
          keyword: show_module
        module:
          from: item 
    app_modules_empty_view:
      view:
        tag: 'div'
        children:
          - text:
              literal: "No modules found"
    app_module_table_item_view:
      view:
        tag: "tr"
        attrs:
          key:
            from: name
            at: item
        children:
          - tag: td
            children:
              - tag: a
                attrs:
                  class: "c-hand"
                  onclick:
                    encoder: module_selection
                children:
                  - text:
                      from: name
                      at: item
    app_modules_table_view:
      view:
        view: table
        params:
          object:
            headers:
              list:
                - object:
                    title: 
                      text:
                        literal: "Name"
            items:
              from: modules
            item_view:
              keyword: app_module_table_item_view
    
    app_modules_section_view:
      view:
        tag: div
        children:
          - tag: h4
            children:
              - text: 
                  literal: "Modules"
          - view:
              from: modules_view
            params:
              object:
                modules:
                  from: modules

    app_setting_name_view:
      view:
        tag: div
        attrs:
          key: 
            from: key
            at: item
        children:
          - tag: strong
            children:
              - text:
                  from: key
                  at: item
    app_setting_value_view:
      view:
        tag: div
        attrs:
          key: 
            from: key
            at: item
        children:
          - text:
              from: value
              at: item
    app_settings_view:
      view:
        tag: div
        attrs:
          class: "section-view"
        children:
          - tag: h4
            children:
              - text:
                  literal: "Settings"
          - tag: div
            attrs:
              key: "info"
              class: "card"
            children:
              - tag: div
                attrs:
                  class: "card-body columns"
                children:
                  - tag: div
                    attrs:
                      class: "col-3"
                    children:
                      - tag: div
                        children:
                          - tag: strong
                            children:
                              - text:
                                  literal: "Category"
                      - tag: div
                        children:
                          - tag: strong
                            children:
                              - text:
                                  literal: "Debug"
                  - tag: div
                    attrs:
                      class: "col-3"
                    children:
                      - tag: div
                        children:
                          - text:
                              from: category
                              at: info
                      - tag: div
                        children:
                          - text:
                              from: debug
                              at: info
                  - tag: div
                    attrs:
                      class: "col-3"
                    children:
                      loop:
                        from: config
                      with: app_setting_name_view 

                  - tag: div
                    attrs:
                      class: "col-3"
                    children:
                      loop:
                        from: config
                      with: app_setting_value_view

    app_sections_view:
      view:
        tag: div
        children:
          - view: app_settings_view
            params:
              object:
                info:
                  from: info
                  at: data
                config:
                  from: config
                  at: data
          - view: app_modules_section_view
            params:
              object:
                modules_view:
                  from: modules_view
                  at: data
                modules:
                  from: modules
                  at: data
    app_main_view:
      view:
        view: main
        params:
          object:
            title:
              text:
                from: app
                at: data
            view:
              keyword: app_sections_view
            data:
              from: data
    app_view: 
      view:
        view: layout
        params:
          object:
            message:
              from: message
            content_view:
              keyword: app_main_view
            contents:
              object:
                app: 
                  from: app
                config:
                  from: config
                info:
                  object:
                    category:
                      from: category
                    debug:
                      from: debug
                modules:
                  from: modules
                modules_view:
                  from: modules_view
            sidebar:
              keyword: admin_sidebar
  decoders:
    app_info:
      object:
        effect:
          keyword: ws
        data:
          object:
            info:
              object:
                debug:
                  any: boolean
                category:
                  any: text
    app_config:
      object:
        effect:
          keyword: ws
        data:
          object:
            config:
              entries:
                one_of:
                  - text: any
                  - number: any
    modules:
      object:
        effect:
          keyword: ws
        data:
          object:
            modules:
              list:
                object:
                  name:
                    text: any
    no_modules:
      object:
        effect:
          keyword: ws
        data:
          object:
            modules:
              list: empty
    show_app:
      object:
        effect:
          keyword: ui
        event:
          object:
            name:
              keyword: show_app
            app:
              object:
                name: 
                  text: any
